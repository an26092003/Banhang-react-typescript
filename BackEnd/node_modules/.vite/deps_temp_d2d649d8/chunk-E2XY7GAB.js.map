{
  "version": 3,
  "sources": ["../../vary/index.js"],
  "sourcesContent": ["/*!\r\n * vary\r\n * Copyright(c) 2014-2017 Douglas Christopher Wilson\r\n * MIT Licensed\r\n */\r\n\r\n'use strict'\r\n\r\n/**\r\n * Module exports.\r\n */\r\n\r\nmodule.exports = vary\r\nmodule.exports.append = append\r\n\r\n/**\r\n * RegExp to match field-name in RFC 7230 sec 3.2\r\n *\r\n * field-name    = token\r\n * token         = 1*tchar\r\n * tchar         = \"!\" / \"#\" / \"$\" / \"%\" / \"&\" / \"'\" / \"*\"\r\n *               / \"+\" / \"-\" / \".\" / \"^\" / \"_\" / \"`\" / \"|\" / \"~\"\r\n *               / DIGIT / ALPHA\r\n *               ; any VCHAR, except delimiters\r\n */\r\n\r\nvar FIELD_NAME_REGEXP = /^[!#$%&'*+\\-.^_`|~0-9A-Za-z]+$/\r\n\r\n/**\r\n * Append a field to a vary header.\r\n *\r\n * @param {String} header\r\n * @param {String|Array} field\r\n * @return {String}\r\n * @public\r\n */\r\n\r\nfunction append (header, field) {\r\n  if (typeof header !== 'string') {\r\n    throw new TypeError('header argument is required')\r\n  }\r\n\r\n  if (!field) {\r\n    throw new TypeError('field argument is required')\r\n  }\r\n\r\n  // get fields array\r\n  var fields = !Array.isArray(field)\r\n    ? parse(String(field))\r\n    : field\r\n\r\n  // assert on invalid field names\r\n  for (var j = 0; j < fields.length; j++) {\r\n    if (!FIELD_NAME_REGEXP.test(fields[j])) {\r\n      throw new TypeError('field argument contains an invalid header name')\r\n    }\r\n  }\r\n\r\n  // existing, unspecified vary\r\n  if (header === '*') {\r\n    return header\r\n  }\r\n\r\n  // enumerate current values\r\n  var val = header\r\n  var vals = parse(header.toLowerCase())\r\n\r\n  // unspecified vary\r\n  if (fields.indexOf('*') !== -1 || vals.indexOf('*') !== -1) {\r\n    return '*'\r\n  }\r\n\r\n  for (var i = 0; i < fields.length; i++) {\r\n    var fld = fields[i].toLowerCase()\r\n\r\n    // append value (case-preserving)\r\n    if (vals.indexOf(fld) === -1) {\r\n      vals.push(fld)\r\n      val = val\r\n        ? val + ', ' + fields[i]\r\n        : fields[i]\r\n    }\r\n  }\r\n\r\n  return val\r\n}\r\n\r\n/**\r\n * Parse a vary header into an array.\r\n *\r\n * @param {String} header\r\n * @return {Array}\r\n * @private\r\n */\r\n\r\nfunction parse (header) {\r\n  var end = 0\r\n  var list = []\r\n  var start = 0\r\n\r\n  // gather tokens\r\n  for (var i = 0, len = header.length; i < len; i++) {\r\n    switch (header.charCodeAt(i)) {\r\n      case 0x20: /*   */\r\n        if (start === end) {\r\n          start = end = i + 1\r\n        }\r\n        break\r\n      case 0x2c: /* , */\r\n        list.push(header.substring(start, end))\r\n        start = end = i + 1\r\n        break\r\n      default:\r\n        end = i + 1\r\n        break\r\n    }\r\n  }\r\n\r\n  // final token\r\n  list.push(header.substring(start, end))\r\n\r\n  return list\r\n}\r\n\r\n/**\r\n * Mark that a request is varied on a header field.\r\n *\r\n * @param {Object} res\r\n * @param {String|Array} field\r\n * @public\r\n */\r\n\r\nfunction vary (res, field) {\r\n  if (!res || !res.getHeader || !res.setHeader) {\r\n    // quack quack\r\n    throw new TypeError('res argument is required')\r\n  }\r\n\r\n  // get existing header\r\n  var val = res.getHeader('Vary') || ''\r\n  var header = Array.isArray(val)\r\n    ? val.join(', ')\r\n    : String(val)\r\n\r\n  // set new header\r\n  if ((val = append(header, field))) {\r\n    res.setHeader('Vary', val)\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;AAAA;AAAA;AAAA;AAYA,WAAO,UAAU;AACjB,WAAO,QAAQ,SAAS;AAaxB,QAAI,oBAAoB;AAWxB,aAAS,OAAQ,QAAQ,OAAO;AAC9B,UAAI,OAAO,WAAW,UAAU;AAC9B,cAAM,IAAI,UAAU,6BAA6B;AAAA,MACnD;AAEA,UAAI,CAAC,OAAO;AACV,cAAM,IAAI,UAAU,4BAA4B;AAAA,MAClD;AAGA,UAAI,SAAS,CAAC,MAAM,QAAQ,KAAK,IAC7B,MAAM,OAAO,KAAK,CAAC,IACnB;AAGJ,eAAS,IAAI,GAAG,IAAI,OAAO,QAAQ,KAAK;AACtC,YAAI,CAAC,kBAAkB,KAAK,OAAO,CAAC,CAAC,GAAG;AACtC,gBAAM,IAAI,UAAU,gDAAgD;AAAA,QACtE;AAAA,MACF;AAGA,UAAI,WAAW,KAAK;AAClB,eAAO;AAAA,MACT;AAGA,UAAI,MAAM;AACV,UAAI,OAAO,MAAM,OAAO,YAAY,CAAC;AAGrC,UAAI,OAAO,QAAQ,GAAG,MAAM,MAAM,KAAK,QAAQ,GAAG,MAAM,IAAI;AAC1D,eAAO;AAAA,MACT;AAEA,eAAS,IAAI,GAAG,IAAI,OAAO,QAAQ,KAAK;AACtC,YAAI,MAAM,OAAO,CAAC,EAAE,YAAY;AAGhC,YAAI,KAAK,QAAQ,GAAG,MAAM,IAAI;AAC5B,eAAK,KAAK,GAAG;AACb,gBAAM,MACF,MAAM,OAAO,OAAO,CAAC,IACrB,OAAO,CAAC;AAAA,QACd;AAAA,MACF;AAEA,aAAO;AAAA,IACT;AAUA,aAAS,MAAO,QAAQ;AACtB,UAAI,MAAM;AACV,UAAI,OAAO,CAAC;AACZ,UAAI,QAAQ;AAGZ,eAAS,IAAI,GAAG,MAAM,OAAO,QAAQ,IAAI,KAAK,KAAK;AACjD,gBAAQ,OAAO,WAAW,CAAC,GAAG;AAAA,UAC5B,KAAK;AACH,gBAAI,UAAU,KAAK;AACjB,sBAAQ,MAAM,IAAI;AAAA,YACpB;AACA;AAAA,UACF,KAAK;AACH,iBAAK,KAAK,OAAO,UAAU,OAAO,GAAG,CAAC;AACtC,oBAAQ,MAAM,IAAI;AAClB;AAAA,UACF;AACE,kBAAM,IAAI;AACV;AAAA,QACJ;AAAA,MACF;AAGA,WAAK,KAAK,OAAO,UAAU,OAAO,GAAG,CAAC;AAEtC,aAAO;AAAA,IACT;AAUA,aAAS,KAAM,KAAK,OAAO;AACzB,UAAI,CAAC,OAAO,CAAC,IAAI,aAAa,CAAC,IAAI,WAAW;AAE5C,cAAM,IAAI,UAAU,0BAA0B;AAAA,MAChD;AAGA,UAAI,MAAM,IAAI,UAAU,MAAM,KAAK;AACnC,UAAI,SAAS,MAAM,QAAQ,GAAG,IAC1B,IAAI,KAAK,IAAI,IACb,OAAO,GAAG;AAGd,UAAK,MAAM,OAAO,QAAQ,KAAK,GAAI;AACjC,YAAI,UAAU,QAAQ,GAAG;AAAA,MAC3B;AAAA,IACF;AAAA;AAAA;",
  "names": []
}
